BlacklistedExplosions = {
    { id = 0, time = "Ban",  webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Grenades
    { id = 1, time = "Ban",  webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Sticky Bombs
    { id = 2, time = "Ban",  webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Grenade Launcher
    { id = 3, time = "Ban",  webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Molotov Cocktails
    { id = 4, time = "Ban",  webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Rockets
    { id = 5, time = "Ban",  webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Tank Shells
    { id = 6, time = "Ban",  webhook = "", limit = 4, audio = true, scale = 1.0, invisible = false }, -- Hi Octane
    { id = 7, time = "Ban",  webhook = "", limit = 5, audio = true, scale = 1.0, invisible = false }, -- Car Explosions
    { id = 18, time = "Ban", webhook = "", limit = 12, audio = true, scale = 1.0, invisible = false }, -- Bullet Explosions
    { id = 19, time = "Ban", webhook = "", limit = 12, audio = true, scale = 1.0, invisible = false }, -- Smoke Grenade Launcher
    { id = 20, time = "Ban", webhook = "", limit = 5, audio = true, scale = 1.0, invisible = false }, -- Smoke Grenades
    { id = 21, time = "Ban", webhook = "", limit = 5, audio = true, scale = 1.0, invisible = false }, -- BZ Gas
    { id = 22, time = "Ban", webhook = "", limit = 5, audio = true, scale = 1.0, invisible = false }, -- Flares
    { id = 25, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Programmable AR
    { id = 36, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Railgun
    { id = 37, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Blimp 2
    { id = 38, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Fireworks
    { id = 40, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Proximity Mines
    { id = 43, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Pipe Bombs
    { id = 44, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Vehicle Mines
    { id = 45, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Explosive Ammo
    { id = 46, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- APC Shells
    { id = 47, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Cluster Bombs
    { id = 48, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Gas Bombs
    { id = 49, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Incendiary Bombs
    { id = 50, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Standard Bombs
    { id = 51, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Torpedoes
    { id = 52, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Underwater Torpedoes
    { id = 53, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Bombushka Cannon
    { id = 54, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Cluster Bomb Secondary Explosions
    { id = 55, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Hunter Barrage
    { id = 56, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Hunter Cannon
    { id = 57, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Rogue Cannon
    { id = 58, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Underwater Mines
    { id = 59, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Orbital Cannon
    { id = 60, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Wide Standard Bombs
    { id = 61, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Explosive Shotgun Ammo
    { id = 62, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Oppressor 2 Cannon
    { id = 63, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Kinetic Mortar
    { id = 64, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Kinetic Vehicle Mine
    { id = 65, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- EMP Vehicle Mine
    { id = 66, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Spike Vehicle Mine
    { id = 67, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Slick Vehicle Mine
    { id = 68, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Tar Vehicle Mine
    { id = 69, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Script Drone
    { id = 70, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Raygun
	{ id = 71, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Buried Mine
	{ id = 72, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Script Missle
	{ id = 82, time = "Ban", webhook = "", limit = 1, audio = true, scale = 1.0, invisible = false }, -- Submarine
}

local whitelist = {}
local explosions = {}
local detected = {}
local false_explosions = {
    [11] = true,
    [12] = true,
    [13] = true,
    [24] = true,
    [30] = true,
}


Discord.Register("explosin_log", "Log Explosions", "logs-explosions")

AddEventHandler('explosionEvent', function(sender, ev)
    explosions[sender] = explosions[sender] or {}
    
    if ev.ownerNetId == 0 then
        CancelEvent()
        return
    end

    local explosionType = ev.explosionType
    local explosionPos = ev.posX and ev.posY and ev.posZ and vector3(ev.posX, ev.posY, ev.posZ) or "Unknown"
    local explosionDamage = ev.damageScale or "Unknown"
    local resourceName = GetInvokingResource()
    local PLAYER_DATA <const> = GetPlayerId(sender)

    for k, v in pairs(BlacklistedExplosions) do
        if ev.explosionType == v.id then
            local explosionInfo = string.format("Explosion Type: %d, Position: (%.2f, %.2f, %.2f)", ev.explosionType, ev.posX, ev.posY, ev.posZ)

            if v.limit and explosions[sender][v.id] and explosions[sender][v.id] >= v.limit then
                if PLAYER_DATA then
                    local message = DiscordMessage();
                    if DiscordId(sender) then  
                        returnMessage = PLAYER_DATA.username.." ("..PLAYER_DATA.uuid..") | Discord ID: <@"..DiscordId(src)..">"
                    else
                        returnMessage = PLAYER_DATA.username.." ("..PLAYER_DATA.uuid..")"
                    end
                    message:SetMessage(string.format("**%s** has used an explosive.**", PLAYER_DATA.name))
                    message:AddField()
                        :SetName("Username")
                        :SetValue(returnMessage);
                    message:AddField()
                        :SetName("Explosion Type")
                        :SetValue(explosionType);
                    message:AddField()
                    Discord.Send("explosin_log", message);
                    CancelEvent()
                    return
                end
            end

            explosions[sender][v.id] = (explosions[sender][v.id] or 0) + 1

            if v.limit and explosions[sender][v.id] > v.limit then
                if PLAYER_DATA then
                    local message = DiscordMessage();
                    if DiscordId(sender) then  
                        returnMessage = PLAYER_DATA.username.." ("..PLAYER_DATA.uuid..") | Discord ID: <@"..DiscordId(src)..">"
                    else
                        returnMessage = PLAYER_DATA.username.." ("..PLAYER_DATA.uuid..")"
                    end
                    message:SetMessage(string.format("**%s** has used an explosive.**", PLAYER_DATA.name))
                    message:AddField()
                        :SetName("Username")
                        :SetValue(returnMessage);
                    message:AddField()
                        :SetName("Explosion Type")
                        :SetValue(explosionType);
                    Discord.Send("explosin_log", message);
                    CancelEvent()
                    return
                end
            end

            if v.limit then
                if explosions[sender][v.id] > v.limit then
                    if false_explosions[ev.explosionType] then return end
                    if not detected[sender] then
                        if PLAYER_DATA then
                            local message = DiscordMessage();
                            if DiscordId(sender) then  
                                returnMessage = PLAYER_DATA.username.." ("..PLAYER_DATA.uuid..") | Discord ID: <@"..DiscordId(src)..">"
                            else
                                returnMessage = PLAYER_DATA.username.." ("..PLAYER_DATA.uuid..")"
                            end
                            message:SetMessage(string.format("**%s** has used an explosive.**", PLAYER_DATA.name))
                            message:AddField()
                                :SetName("Username")
                                :SetValue(returnMessage);
                            message:AddField()
                                :SetName("Explosion Type")
                                :SetValue(explosionType);
                            Discord.Send("explosin_log", message);
                            detected[sender] = true
                            CancelEvent()
                            return
                        end
                        detected[sender] = true
                    end
                end
            end

            if v.audio and ev.isAudible == false then

                if PLAYER_DATA then 
                    local message = DiscordMessage();
                    if DiscordId(sender) then  
                        returnMessage = PLAYER_DATA.username.." ("..PLAYER_DATA.uuid..") | Discord ID: <@"..DiscordId(src)..">"
                    else
                        returnMessage = PLAYER_DATA.username.." ("..PLAYER_DATA.uuid..")"
                    end
                    message:SetMessage(string.format("**%s** has used an explosive audio.**", PLAYER_DATA.name))
                    message:AddField()
                        :SetName("Username")
                        :SetValue(returnMessage);
                    message:AddField()
                        :SetName("Explosion Type")
                        :SetValue(explosionType);
                    Discord.Send("explosin_log", message);
                    CancelEvent()
                    return
                end
            end

            if v.invisible and ev.isInvisible == true then
                if PLAYER_DATA then     
                    local message = DiscordMessage();
                    if DiscordId(sender) then  
                        returnMessage = PLAYER_DATA.username.." ("..PLAYER_DATA.uuid..") | Discord ID: <@"..DiscordId(src)..">"
                    else
                        returnMessage = PLAYER_DATA.username.." ("..PLAYER_DATA.uuid..")"
                    end 
                    message:SetMessage(string.format("**%s** has used an explosive invisible.**", PLAYER_DATA.name))
                    message:AddField()
                        :SetName("Username")
                        :SetValue(returnMessage);
                    message:AddField()
                        :SetName("Explosion Type")
                        :SetValue(explosionType);
                    Discord.Send("explosin_log", message);
                    CancelEvent()
                    return
                end
            end

            if v.damageScale and ev.damageScale > 1.0 then
                if PLAYER_DATA then 
                    local message = DiscordMessage();
                    if DiscordId(sender) then  
                        returnMessage = PLAYER_DATA.username.." ("..PLAYER_DATA.uuid..") | Discord ID: <@"..DiscordId(src)..">"
                    else
                        returnMessage = PLAYER_DATA.username.." ("..PLAYER_DATA.uuid..")"
                    end
                    message:SetMessage(string.format("**%s** has used an explosive boosted.**", PLAYER_DATA.name))
                    message:AddField()
                        :SetName("Username")
                        :SetValue(returnMessage);
                    message:AddField()
                        :SetName("Explosion Type")
                        :SetValue(explosionType);
                    Discord.Send("explosin_log", message);
                    CancelEvent()
                    return
                end
            end
        end
    end
end)